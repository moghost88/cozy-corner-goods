var M=Object.defineProperty,T=Object.defineProperties;var U=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var w=(s,a,r)=>a in s?M(s,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[a]=r,S=(s,a)=>{for(var r in a||(a={}))$.call(a,r)&&w(s,r,a[r]);if(y)for(var r of y(a))I.call(a,r)&&w(s,r,a[r]);return s},P=(s,a)=>T(s,U(a));var x=(s,a,r)=>new Promise((o,c)=>{var d=i=>{try{l(r.next(i))}catch(m){c(m)}},u=i=>{try{l(r.throw(i))}catch(m){c(m)}},l=i=>i.done?o(i.value):Promise.resolve(i.value).then(d,u);l((r=r.apply(s,a)).next())});import{j as e}from"./ui-components-Cwvw8Ahd.js";import{d as z,r as n,L as R}from"./react-vendor-CGklD7G4.js";import{b as Y,d as G,s as g}from"./index-Aa0nxjPB.js";import{B as h,I as _}from"./logo-DqJMHvt2.js";import{L}from"./label-UdSWVM_n.js";import{N as H,F as J}from"./Footer-BU0QWao3.js";import{L as k,j as K,U as Q,P as E,k as V,D as C,l as W}from"./icons-Om4nLF3E.js";import"./utils-RvYD77G1.js";import"./supabase-CLqt2Rfr.js";const le=()=>{const{user:s,loading:a,signOut:r}=Y(),o=z(),{toast:c}=G(),[d,u]=n.useState(null),[l,i]=n.useState([]),[m,D]=n.useState(!0),[j,b]=n.useState(!1),[p,N]=n.useState(""),[f,v]=n.useState("purchases");n.useEffect(()=>{!a&&!s&&o("/auth")},[s,a,o]),n.useEffect(()=>{s&&(F(),O())},[s]);const F=()=>x(void 0,null,function*(){if(!s)return;const{data:t,error:B}=yield g.from("profiles").select("display_name, avatar_url").eq("user_id",s.id).single();t&&(u(t),N(t.display_name||"")),D(!1)}),O=()=>x(void 0,null,function*(){if(!s)return;const{data:t,error:B}=yield g.from("purchases").select("*").eq("user_id",s.id).order("purchased_at",{ascending:!1});t&&i(t)}),q=()=>x(void 0,null,function*(){if(!s)return;b(!0);const{error:t}=yield g.from("profiles").update({display_name:p}).eq("user_id",s.id);t?c({title:"Error",description:"Failed to update profile.",variant:"destructive"}):(c({title:"Profile updated",description:"Your changes have been saved."}),u(P(S({},d),{display_name:p}))),b(!1)}),A=()=>x(void 0,null,function*(){yield r(),o("/")});return a||m?e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-background",children:e.jsx(k,{className:"h-8 w-8 animate-spin text-primary"})}):s?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(H,{}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"font-display text-3xl font-bold text-foreground",children:["My ",e.jsx("span",{className:"text-gradient-hero",children:"Account"})]}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your profile and view your purchases"})]}),e.jsxs(h,{variant:"outline",onClick:A,className:"gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),"Sign Out"]})]}),e.jsx("div",{className:"mb-8 rounded-2xl border border-border bg-card p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-2xl bg-gradient-hero",children:e.jsx(Q,{className:"h-8 w-8 text-primary-foreground"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-display text-xl font-semibold text-foreground",children:(d==null?void 0:d.display_name)||"User"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.email})]})]})}),e.jsxs("div",{className:"mb-6 flex gap-2 border-b border-border",children:[e.jsxs("button",{onClick:()=>v("purchases"),className:`flex items-center gap-2 border-b-2 px-4 py-3 text-sm font-medium transition-colors ${f==="purchases"?"border-primary text-foreground":"border-transparent text-muted-foreground hover:text-foreground"}`,children:[e.jsx(E,{className:"h-4 w-4"}),"My Purchases"]}),e.jsxs("button",{onClick:()=>v("settings"),className:`flex items-center gap-2 border-b-2 px-4 py-3 text-sm font-medium transition-colors ${f==="settings"?"border-primary text-foreground":"border-transparent text-muted-foreground hover:text-foreground"}`,children:[e.jsx(V,{className:"h-4 w-4"}),"Settings"]})]}),f==="purchases"?e.jsx("div",{className:"rounded-2xl border border-border bg-card",children:l.length>0?e.jsx("div",{className:"divide-y divide-border",children:l.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-xl bg-secondary/20",children:e.jsx(C,{className:"h-5 w-5 text-secondary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-foreground",children:t.product_name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Purchased on"," ",new Date(t.purchased_at).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"font-display font-semibold text-foreground",children:["$",t.price]}),e.jsxs(h,{variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(C,{className:"h-4 w-4"}),"Download"]})]})]},t.id))}):e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(E,{className:"mx-auto mb-4 h-12 w-12 text-muted-foreground/50"}),e.jsx("h3",{className:"mb-2 font-display text-lg font-semibold text-foreground",children:"No purchases yet"}),e.jsx("p",{className:"mb-4 text-muted-foreground",children:"Start exploring our digital products!"}),e.jsx(R,{to:"/",children:e.jsx(h,{variant:"gradient",children:"Browse Products"})})]})}):e.jsxs("div",{className:"rounded-2xl border border-border bg-card p-6",children:[e.jsx("h3",{className:"mb-6 font-display text-lg font-semibold text-foreground",children:"Profile Settings"}),e.jsxs("div",{className:"max-w-md space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"email",children:"Email"}),e.jsx(_,{id:"email",type:"email",value:s.email||"",disabled:!0,className:"bg-muted"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Email cannot be changed"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"displayName",children:"Display Name"}),e.jsx(_,{id:"displayName",type:"text",value:p,onChange:t=>N(t.target.value),placeholder:"Enter your display name"})]}),e.jsx(h,{onClick:q,variant:"gradient",disabled:j,className:"gap-2",children:j?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"h-4 w-4 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"h-4 w-4"}),"Save Changes"]})})]})]})]}),e.jsx(J,{})]}):null};export{le as default};
