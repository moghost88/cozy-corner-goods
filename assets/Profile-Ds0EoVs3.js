import{c as w,l as M,s as q,m as z,r as t,t as c,j as e,L as j,q as O}from"./index-BzzuNZSM.js";import{B as i,U as V,I as v}from"./logo-QEkxIfKD.js";import{L as b}from"./label-DkLQ_kIz.js";import{N as A,L as B,F as I}from"./Footer-DONgzQM4.js";import{P as N}from"./package-DBBBK7J_.js";import{D as y}from"./download-Bn4gEKdG.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=w("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=w("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),K=()=>{const{user:a,loading:n,signOut:S}=M(),l=q(),{toast:m}=z(),[r,x]=t.useState(null),[u,k]=t.useState([]),[P,_]=t.useState(!0),[h,p]=t.useState(!1),[d,f]=t.useState(""),[o,g]=t.useState("purchases");t.useEffect(()=>{!n&&!a&&l("/auth")},[a,n,l]),t.useEffect(()=>{a&&(L(),E())},[a]);const L=async()=>{if(!a)return;const{data:s,error:F}=await c.from("profiles").select("display_name, avatar_url").eq("user_id",a.id).single();s&&(x(s),f(s.display_name||"")),_(!1)},E=async()=>{if(!a)return;const{data:s,error:F}=await c.from("purchases").select("*").eq("user_id",a.id).order("purchased_at",{ascending:!1});s&&k(s)},C=async()=>{if(!a)return;p(!0);const{error:s}=await c.from("profiles").update({display_name:d}).eq("user_id",a.id);s?m({title:"Error",description:"Failed to update profile.",variant:"destructive"}):(m({title:"Profile updated",description:"Your changes have been saved."}),x({...r,display_name:d})),p(!1)},D=async()=>{await S(),l("/")};return n||P?e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-background",children:e.jsx(j,{className:"h-8 w-8 animate-spin text-primary"})}):a?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(A,{}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"font-display text-3xl font-bold text-foreground",children:["My ",e.jsx("span",{className:"text-gradient-hero",children:"Account"})]}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your profile and view your purchases"})]}),e.jsxs(i,{variant:"outline",onClick:D,className:"gap-2",children:[e.jsx(B,{className:"h-4 w-4"}),"Sign Out"]})]}),e.jsx("div",{className:"mb-8 rounded-2xl border border-border bg-card p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-2xl bg-gradient-hero",children:e.jsx(V,{className:"h-8 w-8 text-primary-foreground"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-display text-xl font-semibold text-foreground",children:(r==null?void 0:r.display_name)||"User"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.email})]})]})}),e.jsxs("div",{className:"mb-6 flex gap-2 border-b border-border",children:[e.jsxs("button",{onClick:()=>g("purchases"),className:`flex items-center gap-2 border-b-2 px-4 py-3 text-sm font-medium transition-colors ${o==="purchases"?"border-primary text-foreground":"border-transparent text-muted-foreground hover:text-foreground"}`,children:[e.jsx(N,{className:"h-4 w-4"}),"My Purchases"]}),e.jsxs("button",{onClick:()=>g("settings"),className:`flex items-center gap-2 border-b-2 px-4 py-3 text-sm font-medium transition-colors ${o==="settings"?"border-primary text-foreground":"border-transparent text-muted-foreground hover:text-foreground"}`,children:[e.jsx(U,{className:"h-4 w-4"}),"Settings"]})]}),o==="purchases"?e.jsx("div",{className:"rounded-2xl border border-border bg-card",children:u.length>0?e.jsx("div",{className:"divide-y divide-border",children:u.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-xl bg-secondary/20",children:e.jsx(y,{className:"h-5 w-5 text-secondary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-foreground",children:s.product_name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Purchased on"," ",new Date(s.purchased_at).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"font-display font-semibold text-foreground",children:["$",s.price]}),e.jsxs(i,{variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(y,{className:"h-4 w-4"}),"Download"]})]})]},s.id))}):e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(N,{className:"mx-auto mb-4 h-12 w-12 text-muted-foreground/50"}),e.jsx("h3",{className:"mb-2 font-display text-lg font-semibold text-foreground",children:"No purchases yet"}),e.jsx("p",{className:"mb-4 text-muted-foreground",children:"Start exploring our digital products!"}),e.jsx(O,{to:"/",children:e.jsx(i,{variant:"gradient",children:"Browse Products"})})]})}):e.jsxs("div",{className:"rounded-2xl border border-border bg-card p-6",children:[e.jsx("h3",{className:"mb-6 font-display text-lg font-semibold text-foreground",children:"Profile Settings"}),e.jsxs("div",{className:"max-w-md space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"email",children:"Email"}),e.jsx(v,{id:"email",type:"email",value:a.email||"",disabled:!0,className:"bg-muted"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Email cannot be changed"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"displayName",children:"Display Name"}),e.jsx(v,{id:"displayName",type:"text",value:d,onChange:s=>f(s.target.value),placeholder:"Enter your display name"})]}),e.jsx(i,{onClick:C,variant:"gradient",disabled:h,className:"gap-2",children:h?e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"h-4 w-4 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"h-4 w-4"}),"Save Changes"]})})]})]})]}),e.jsx(I,{})]}):null};export{K as default};
